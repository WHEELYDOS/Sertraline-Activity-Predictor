<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sertraline Activity Predictor</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f7f8fa;
        padding: 30px;
        color: #1f2937;
    }

    main {
        max-width: 820px;
        margin: 0 auto;
    }

    .panel {
        background: white;
        padding: 22px;
        border-radius: 10px;
        border: 1px solid #e5e7eb;
        margin-bottom: 22px;
    }

    h1 { font-size: 1.6rem; margin-bottom: 4px; font-weight: bold; }
    h2 { margin-bottom: 12px; font-size: 1.2rem; }

    label {
        font-weight: bold;
        display: block;
        margin-top: 14px;
        margin-bottom: 6px;
    }

    input, select {
        width: 100%;
        padding: 12px;
        border-radius: 6px;
        border: 1px solid #cbd5e1;
        font-size: 1rem;
    }

    button {
        margin-top: 20px;
        width: 100%;
        padding: 14px;
        background: #2563eb;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
    }

    button:disabled {
        background: #9ca3af;
        cursor: not-allowed;
    }

    .status {
        margin-top: 16px;
        padding: 12px;
        border-radius: 6px;
        display: none;
    }

    .info { background: #e0e7ff; border: 1px solid #c7d2fe; }
    .error { background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; }

    /* Progress bars */
    .progress-container {
        background: #e5e7eb;
        height: 20px;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 6px;
        margin-bottom: 14px;
    }

    .progress-fill {
        height: 100%;
        width: 0%;
        transition: width 0.5s ease;
    }

    .bar-green { background: #16a34a; }
    .bar-red   { background: #dc2626; }
    .bar-blue  { background: #2563eb; }

    .prob-label {
        font-weight: bold;
        margin-bottom: 4px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
    }

    th, td {
        padding: 10px 8px;
        border-bottom: 1px solid #e5e7eb;
        text-align: left;
    }

    th {
        background: #f3f4f6;
        width: 50%;
    }

    .muted { color: #6b7280; font-size: 0.9rem; }
</style>
</head>

<body>
<main>

    <!-- INPUT PANEL -->
    <section class="panel">
        <h1>Sertraline Activity Predictor</h1>
        <p class="muted">Enter a SMILES string and choose a model.</p>

        <label>SMILES</label>
        <input id="smiles" type="text" placeholder="CC(=O)OC1=CC=CC=C1C(=O)O">

        <label>Model</label>
        <select id="model">
            {% for name in model_names %}
                <option value="{{ name }}">{{ name }}</option>
            {% endfor %}
        </select>

        <button id="predict-btn">Run Prediction</button>

        <div id="loading" class="status info">Running prediction...</div>
        <div id="error" class="status error"></div>
    </section>

    <!-- RESULTS PANEL -->
    <section class="panel" id="results" style="display:none;">
        <h2>Prediction Output</h2>
        <p class="muted" id="model-used"></p>

        <!-- Final Result -->
        <h3>Result</h3>
        <p style="font-size: 1.4rem; font-weight: bold;" id="prediction-text">-</p>

        <!-- ACTIVITY BAR -->
        <div class="prob-label">
            Activity Probability: <span id="activity-percent">-</span>
        </div>
        <div class="progress-container">
            <div id="activity-bar" class="progress-fill"></div>
        </div>

        <!-- CONFIDENCE BAR -->
        <div class="prob-label">
            Confidence: <span id="confidence-percent">-</span>
        </div>
        <div class="progress-container">
            <div id="confidence-bar" class="progress-fill bar-blue"></div>
        </div>

        <h3>Probabilities</h3>

        <div class="prob-label">
            Inactive: <span id="prob-inactive-text">-</span>
        </div>
        <div class="progress-container">
            <div id="prob-inactive-bar" class="progress-fill bar-blue"></div>
        </div>

        <div class="prob-label">
            Active: <span id="prob-active-text">-</span>
        </div>
        <div class="progress-container">
            <div id="prob-active-bar" class="progress-fill bar-blue"></div>
        </div>

        <!-- FEATURES TABLE -->
        <h3>Molecular Features</h3>
        <table id="features-table">
            <tbody></tbody>
        </table>
    </section>

</main>

<script>
const btn = document.getElementById("predict-btn");
const loading = document.getElementById("loading");
const errorBox = document.getElementById("error");
const results = document.getElementById("results");

btn.onclick = async () => {
    const smiles = document.getElementById("smiles").value.trim();
    const model = document.getElementById("model").value;

    results.style.display = "none";
    errorBox.style.display = "none";

    if (!smiles) {
        showError("Please enter a SMILES string.");
        return;
    }

    btn.disabled = true;
    loading.style.display = "block";

    try {
        const res = await fetch("/predict", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ smiles, model_name: model })
        });

        const data = await res.json();
        btn.disabled = false;
        loading.style.display = "none";

        if (!res.ok) return showError(data.error);

        showResults(data);

    } catch (err) {
        btn.disabled = false;
        loading.style.display = "none";
        showError(err.message);
    }
};

function showError(msg){
    errorBox.textContent = msg;
    errorBox.style.display = "block";
}

function showResults(data){
    results.style.display = "block";
    document.getElementById("model-used").textContent = "Model: " + data.model_name;

    const pred = data.prediction;
    const p0 = data.probabilities.class_0 * 100;
    const p1 = data.probabilities.class_1 * 100;
    const confidence = data.confidence * 100;

    // Show result text
    document.getElementById("prediction-text").textContent = pred === 1 ? "Active" : "Inactive";

    // Activity percent (class_1)
    document.getElementById("activity-percent").textContent = p1.toFixed(2) + "%";

    const activityBar = document.getElementById("activity-bar");
    activityBar.style.width = p1 + "%";
    activityBar.className = "progress-fill " + (p1 >= 50 ? "bar-green" : "bar-red");

    // // Confidence bar
    // document.getElementById("confidence-percent").textContent = confidence.toFixed(2) + "%";
    // document.getElementById("confidence-bar").style.width = confidence + "%";

    // Probabilities text + bars
    document.getElementById("prob-inactive-text").textContent = p0.toFixed(2) + "%";
    document.getElementById("prob-active-text").textContent = p1.toFixed(2) + "%";

    document.getElementById("prob-inactive-bar").style.width = p0 + "%";
    document.getElementById("prob-active-bar").style.width = p1 + "%";

    // Features table
    const tbody = document.querySelector("#features-table tbody");
    tbody.innerHTML = "";

    for (const [key, value] of Object.entries(data.features)) {
        const row = document.createElement("tr");
        row.innerHTML = `
            <th>${key.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase())}</th>
            <td>${value}</td>
        `;
        tbody.appendChild(row);
    }
}
</script>

</body>
</html>
